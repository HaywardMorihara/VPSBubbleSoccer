<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>VPS Bubble Soccer</title>
        <script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>
    </head>
    <body>

    <script src="controller.js"></script>
    <script src="player.js"></script> 
    <script src="ball.js"></script>
    <script type="text/javascript">

    window.onload = function() {

        var controller1;

        var gameWidth = 720;
        var gameHeight = 540;

        var music;

        //width, height, renderer, parent, state
        var game = new Phaser.Game(gameWidth, gameHeight, Phaser.CANVAS, 'vps-bubble-soccer', { preload: preload, create: create, update: update, render: render });

        var ball;
        var player1;
        //var omfgDogs;

        function preload() {
            game.load.audio('omfgdogs_music', ['assets/music/omfgdogs.mp3']);//, 'assets/audio/bodenstaendig_2000_in_rock_4bit.ogg']); //ogg file for Firefox

            game.load.image('soccer_field', 'assets/sprites/soccerField.jpg');

            game.load.spritesheet('soccer_ball', 'assets/sprites/soccerball.png', 64, 64, 7);
            game.load.spritesheet('player','assets/sprites/annie.png',111, 115, 28);
            //game.load.spritesheet('omfgdogs','assets/sprites/omfgdogs-spritesheet.png',384,80,48)
        }


        function create() {
            initializeControllers();
            initializeMusic();
            initializeSprites();
            initializeAnimations();
            initializePhysics();
            
        }

        function initializeControllers() {
            //Gamecube only works in Firefox...might be able to get external library if I want
            game.input.gamepad.start();
            // To listen to buttons from a specific pad listen directly on that pad game.input.gamepad.padX, where X = pad 1-4
            controller1 = game.input.gamepad.pad1;
        }

        function initializeMusic() {
            music = game.add.audio('omfgdogs_music');
            music.play(); //driving me crazy
        }

        function initializeSprites() {
            game.add.sprite(0, 0, 'soccer_field');

            ball = game.add.sprite(gameWidth/2,gameHeight/2,'soccer_ball');
            ball.anchor.setTo(0.5, 0.5);
            ball.scale.setTo(.75,.75);

            player1 = game.add.sprite(0,0,'player');
            player1.scale.setTo(.75,.75);
            player1.speedValue = 10;
            player1.dampening = 10;

            //omfgDogs = game.add.sprite(0,0,'omfgdogs');

        }

        function initializeAnimations() {
            ball.rollingBallAnim = ball.animations.add('rolling_ball'); 

            player1.walkingRightAnim = player1.animations.add('player_walking_right',[0,1,2,3,4,5,6]);
            player1.walkingUpAnim = player1.animations.add('player_walking_up',[7,8,9,10,11,12,13]);
            player1.walkingDownAnim = player1.animations.add('player_walking_down',[14,15,16,17,18,19,20]);
            player1.walkingLeftAnim = player1.animations.add('player_walking_left',[21,22,23,24,25,26,27]);

            //omfgDogsRunning = omfgDogs.animations.add('omfgdogs_running');
            //omfgDogsRunning.play(10,false);
        }

        function initializePhysics() {
            game.physics.startSystem(Phaser.Physics.ARCADE);
            game.physics.enable([ball,player1], Phaser.Physics.ARCADE);

            ball.body.velocity.setTo(200,200);
            ball.body.collideWorldBounds = true;
            //This sets the image bounce energy for the horizontal
            // and vertical vectors (as an x,y point). "1" is 100% energy return
            ball.body.bounce.setTo(.9,.9);

            player1.body.collideWorldBounds = true;
            player1.body.bounce.setTo(.5,.5);
        }

        function update() {
            game.physics.arcade.collide(player1,ball);

            updatePlayer(player1, controller1);

            //Animation isn't working correctly
            animatePlayer(player1);
            

            animateBall(ball);

        }

        function render() {
            game.debug.bodyInfo(player1, 32, 32);
        }

    };

    </script>

    </body>
</html>